---
id: split-terminal-text-rendering-from
level: task
title: "Split terminal text rendering from glow pipeline"
short_code: "CRT-T-0042"
created_at: 2025-11-26T17:50:55.460070+00:00
updated_at: 2025-11-26T20:56:16.776896+00:00
parent: CRT-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0008
---

# Split terminal text rendering from glow pipeline

## Parent Initiative

[[CRT-I-0008]] - Terminal Rendering Pipeline and ANSI Color Support

## Objective

Route terminal text directly to screen without glow effects. Cursor shape is rendered via vello, then passed through glow shader (triggered by CSS text-shadow property).

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Terminal text renders directly to screen (bypasses glow)
- [ ] Terminal text uses ANSI colors from palette
- [ ] Cursor shape rendered via vello
- [ ] Cursor glow applied via shader (CSS text-shadow)
- [ ] Tab titles still render through glow pipeline
- [ ] No visual regression for UI elements

## Implementation Notes

### Architecture (Vello-First)

With vello handling shapes:
- **Vello**: Cursor shape, selection rectangles, cell backgrounds
- **Glyph pipeline**: Terminal text (ANSI-colored), tab titles
- **Glow shader**: Applied based on CSS `text-shadow` property

### Render Order

1. Background shader (gradient + grid)
2. Vello scene (cursor shape, selection rects) -> texture
3. Terminal text directly to screen (raw ANSI colors)
4. Composite vello texture (cursor gets glow via shader)
5. Tab bar shapes (already vello)
6. Tab titles with glow

### Technical Approach

1. Add cursor shape to vello scene in a new `TerminalVelloRenderer`
2. Terminal text renders direct to screen (no glow)
3. Cursor texture composited with glow shader pass
4. Selection rectangles rendered via vello (no glow)

### Dependencies

- CRT-T-0040 (ANSI palette wiring) should be complete

### Files to Modify

- `crates/crt-renderer/src/terminal_vello.rs` (new) - cursor/selection shapes
- `src/window.rs` - Split text and cursor rendering
- `src/render.rs` - Reorder render passes

## Status Updates

### 2025-11-26: Completed

Implementation complete:

1. Created `TerminalVelloRenderer` in `crates/crt-renderer/src/terminal_vello.rs`:
   - Supports Block, Bar, and Underline cursor shapes
   - Selection row/cell rendering methods
   - Ready for use in CRT-T-0043 with proper resource caching

2. Updated `src/window.rs`:
   - `update_text_buffer()` now returns `Option<CursorInfo>` with cursor position
   - Text rendering separated from cursor rendering
   - Cursor no longer rendered as glyph in the text buffer

3. Updated `src/render.rs`:
   - Terminal text renders directly to frame (bypasses glow pipeline)
   - Grid renderer renders every frame for persistence
   - Cursor rendered as glyph for now (efficient, no per-frame allocations)

Key architectural change: Terminal text no longer goes through the composite/glow shader, rendering directly to the framebuffer with raw ANSI colors.