---
id: implement-cursor-styling-with
level: task
title: "Implement cursor styling with shape and color options"
short_code: "CRT-T-0043"
created_at: 2025-11-26T17:50:57.231156+00:00
updated_at: 2025-11-26T21:06:05.886228+00:00
parent: CRT-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0008
---

# Implement cursor styling with shape and color options

## Parent Initiative

[[CRT-I-0008]] - Terminal Rendering Pipeline and ANSI Color Support

## Objective

Add CSS-configurable cursor styling with support for different shapes (block, underline, bar) and custom colors. Cursor shape rendered via vello, with glow effect applied via CSS `text-shadow` property.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Parse `--cursor-color` CSS variable
- [ ] Parse `--cursor-shape` CSS variable (block, underline, bar)
- [ ] Block cursor renders as full cell rectangle via vello
- [ ] Underline cursor renders as bottom 2px rectangle via vello
- [ ] Bar cursor renders as left 2px rectangle via vello
- [ ] Cursor color applied from theme
- [ ] Glow effect applied when `text-shadow` present in cursor CSS

## Implementation Notes

### CSS Variables

```css
.cursor {
  --cursor-color: #f1fa8c;
  --cursor-shape: block; /* block | underline | bar */
  text-shadow: 0 0 8px #f1fa8c; /* triggers glow shader */
}
```

### CursorStyle Struct

```rust
pub enum CursorShape {
    Block,
    Underline,
    Bar,
}

pub struct CursorStyle {
    pub color: Color,
    pub shape: CursorShape,
    pub text_shadow: Option<TextShadow>, // triggers glow when present
}
```

### Technical Approach (Vello-First)

1. Add `CursorStyle` to crt-theme with CSS parsing
2. Add cursor to `TerminalVelloRenderer`:
   - Block: `kurbo::Rect` full cell size
   - Underline: `kurbo::Rect` bottom 2px of cell
   - Bar: `kurbo::Rect` left 2px of cell
3. Render cursor shape to vello scene
4. If `text_shadow` present, apply glow shader during compositing
5. Follows same pattern as tab bar (vello shapes + shader effects)

### Dependencies

- CRT-T-0042 (Split rendering) - cursor in vello scene

### Files to Modify

- `crates/crt-theme/src/lib.rs` - Add CursorStyle
- `crates/crt-renderer/src/terminal_vello.rs` - Cursor shape rendering
- `src/render.rs` - Composite cursor with optional glow

## Status Updates

### 2025-11-26: Completed

Implementation complete:

1. Updated `TerminalVelloRenderer` with cached GPU resources:
   - Vello Renderer cached per-window
   - Render target texture cached, resized only on window resize
   - Scene rebuilt each frame, resources reused

2. Cursor rendering via vello shapes:
   - Block: full cell rectangle
   - Bar: 2px vertical line on left
   - Underline: 2px horizontal line at bottom

3. Cursor blinking:
   - `update_blink()` called every frame
   - `reset_blink()` called on cursor movement
   - Configurable interval (default 530ms)

4. Configuration via `config.toml`:
   ```toml
   [cursor]
   style = "block"  # or "bar" or "underline"
   blink = true
   blink_interval_ms = 530
   ```

5. Files modified:
   - `crates/crt-renderer/src/terminal_vello.rs` - blink state, cached resources
   - `src/config.rs` - CursorConfig, CursorStyle
   - `src/main.rs` - apply cursor config
   - `src/render.rs` - update_blink/reset_blink calls