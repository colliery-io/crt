---
id: add-selection-highlighting-support
level: task
title: "Add selection highlighting support"
short_code: "CRT-T-0044"
created_at: 2025-11-26T17:50:59.027262+00:00
updated_at: 2025-11-26T17:50:59.027262+00:00
parent: CRT-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0008
---

# Add selection highlighting support

## Parent Initiative

[[CRT-I-0008]] - Terminal Rendering Pipeline and ANSI Color Support

## Objective

Implement text selection highlighting with mouse drag support. Selection renders as a raw color overlay (no glow effects) using theme-defined colors.

## Acceptance Criteria

- [ ] Parse `--selection-background` CSS variable
- [ ] Track mouse drag for selection start/end
- [ ] Hook into alacritty_terminal selection state
- [ ] Render selection rectangles as color overlay
- [ ] Selection renders without glow effects
- [ ] Copy selection to clipboard (Cmd+C / Ctrl+C)

## Implementation Notes

### CSS Variable

```css
--selection-background: rgba(255, 255, 255, 0.3);
```

### Technical Approach

1. Add `selection_background: [f32; 4]` to theme
2. Track mouse events in `src/input.rs`:
   - MouseDown: start selection
   - MouseMove (while down): extend selection
   - MouseUp: finalize selection
3. Convert screen coordinates to terminal grid positions
4. Use alacritty_terminal's selection API:
   ```rust
   terminal.selection_mut().map(|sel| {
       sel.update(point, side);
   });
   ```
5. In `update_text_buffer()`, check if cell is in selection:
   ```rust
   if terminal.selection().map(|s| s.contains(point)).unwrap_or(false) {
       // Render selection background quad
   }
   ```
6. Render selection quads directly to screen (raw color, no glow)

### Selection Rendering

- Render as filled rectangles behind text
- Use alpha blending for semi-transparent overlay
- Render in same pass as terminal text (both raw)

### Dependencies

- CRT-T-0042 (Split rendering) - selection uses raw color pass

### Files to Modify

- `crates/crt-theme/src/lib.rs` - Add selection_background
- `src/input.rs` - Add mouse selection handling
- `src/window.rs` - Render selection rectangles

## Status Updates

*To be added during implementation*