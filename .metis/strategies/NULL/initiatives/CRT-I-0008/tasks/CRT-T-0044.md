---
id: add-selection-highlighting-support
level: task
title: "Add selection highlighting support"
short_code: "CRT-T-0044"
created_at: 2025-11-26T17:50:59.027262+00:00
updated_at: 2025-11-26T17:50:59.027262+00:00
parent: CRT-I-0008
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0008
---

# Add selection highlighting support

## Parent Initiative

[[CRT-I-0008]] - Terminal Rendering Pipeline and ANSI Color Support

## Objective

Implement text selection highlighting with mouse drag support. Selection rectangles rendered via vello (no glow effects) using theme-defined colors.

## Acceptance Criteria

- [ ] Parse `--selection-background` CSS variable
- [ ] Track mouse drag for selection start/end
- [ ] Hook into alacritty_terminal selection state
- [ ] Render selection rectangles via vello
- [ ] Selection renders without glow effects (no text-shadow)
- [ ] Copy selection to clipboard (Cmd+C / Ctrl+C)

## Implementation Notes

### CSS Variable

```css
.selection {
  background: rgba(255, 255, 255, 0.3);
  /* no text-shadow = no glow */
}
```

### Technical Approach (Vello-First)

1. Add `SelectionStyle` to theme with background color
2. Track mouse events in `src/input.rs`:
   - MouseDown: start selection
   - MouseMove (while down): extend selection
   - MouseUp: finalize selection
3. Convert screen coordinates to terminal grid positions
4. Use alacritty_terminal's selection API
5. Add selection rectangles to `TerminalVelloRenderer`:
   - Query selection ranges from terminal
   - Build `kurbo::Rect` for each selected row segment
   - Fill with selection background color (alpha blended)
6. Render selection in vello scene (composited without glow)

### Vello Rendering

```rust
// In TerminalVelloRenderer::build_scene()
for range in selection_ranges {
    let rect = kurbo::Rect::new(
        range.start_x, range.y,
        range.end_x, range.y + cell_height,
    );
    scene.fill(
        peniko::Fill::NonZero,
        kurbo::Affine::IDENTITY,
        &selection_brush,
        None,
        &rect,
    );
}
```

### Dependencies

- CRT-T-0042 (Split rendering) - selection in vello scene

### Files to Modify

- `crates/crt-theme/src/lib.rs` - Add SelectionStyle
- `crates/crt-renderer/src/terminal_vello.rs` - Selection rectangles
- `src/input.rs` - Mouse selection handling

## Status Updates

*To be added during implementation*