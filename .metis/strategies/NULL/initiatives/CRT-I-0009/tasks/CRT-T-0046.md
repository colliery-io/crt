---
id: add-vello-dependency-and-create
level: task
title: "Add vello dependency and create render context"
short_code: "CRT-T-0046"
created_at: 2025-11-26T18:15:41.757625+00:00
updated_at: 2025-11-26T18:15:41.757625+00:00
parent: CRT-I-0009
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0009
---

# Add vello dependency and create render context

*This template includes sections for various types of tasks. Delete sections that don't apply to your specific use case.*

## Parent Initiative **[CONDITIONAL: Assigned Task]**

[[CRT-I-0009]]

## Objective

Add vello as a dependency and create a render context that can work alongside our existing wgpu setup, enabling 2D rendering via vello's compute-shader pipeline.

## Acceptance Criteria

- [ ] `vello` added as dependency
- [ ] VelloRenderer struct created that shares wgpu device/queue
- [ ] Can render a simple shape (rectangle) to texture
- [ ] Vello output can be displayed on screen
- [ ] No regression in existing rendering
- [ ] Performance acceptable (60fps maintained)

## Implementation Notes

### Technical Approach

1. Add `vello` to workspace Cargo.toml
2. Create `crates/crt-renderer/src/vello_renderer.rs`
3. Initialize vello `Renderer` with our existing wgpu device
4. Create a `Scene` that can be built each frame
5. Render scene to texture via `render_to_texture()`

### Code Sketch

```rust
use vello::{Renderer, RendererOptions, Scene, RenderParams};
use vello::util::RenderSurface;

pub struct VelloRenderer {
    renderer: Renderer,
    scene: Scene,
}

impl VelloRenderer {
    pub fn new(device: &wgpu::Device) -> Self {
        let renderer = Renderer::new(
            device,
            RendererOptions {
                surface_format: None, // We render to texture
                use_cpu: false,
                antialiasing_support: vello::AaSupport::all(),
                num_init_threads: None,
            },
        ).unwrap();
        
        Self {
            renderer,
            scene: Scene::new(),
        }
    }
    
    pub fn render_to_texture(
        &mut self,
        device: &wgpu::Device,
        queue: &wgpu::Queue,
        texture: &wgpu::TextureView,
        width: u32,
        height: u32,
    ) {
        self.renderer.render_to_texture(
            device,
            queue,
            &self.scene,
            texture,
            &RenderParams {
                base_color: vello::peniko::Color::TRANSPARENT,
                width,
                height,
                antialiasing_method: vello::AaConfig::Msaa16,
            },
        ).unwrap();
    }
}
```

### Files to Create/Modify

- `Cargo.toml` (workspace) - Add vello dependency
- `crates/crt-renderer/Cargo.toml` - Add vello dependency
- `crates/crt-renderer/src/vello_renderer.rs` (new)
- `crates/crt-renderer/src/lib.rs` - Export VelloRenderer

### Dependencies

- Can run in parallel with CRT-T-0045 (lightningcss)

## Status Updates

*To be added during implementation*