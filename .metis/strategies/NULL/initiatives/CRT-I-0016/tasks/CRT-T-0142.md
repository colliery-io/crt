---
id: implement-spriteoverlay-one-shot
level: task
title: "Implement SpriteOverlay - one-shot effect sprites"
short_code: "CRT-T-0142"
created_at: 2025-12-29T18:52:01.789665+00:00
updated_at: 2025-12-29T19:30:19.632825+00:00
parent: CRT-I-0016
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0016
---

# Implement SpriteOverlay - one-shot effect sprites

**Phase 5** - Overlay sprites for event effects.

## Objective

Render one-shot effect sprites at specified positions (center, cursor, sprite, random) during event overrides.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] `SpriteOverlayState` struct for tracking overlay animation
- [ ] Position `center` - centered in viewport
- [ ] Position `cursor` - at text cursor location
- [ ] Position `sprite` - tracks backdrop sprite's current position
- [ ] Position `random` - random viewport position (set once at start)
- [ ] One-shot animation plays through all frames once
- [ ] Overlay cleaned up when animation completes OR override expires
- [ ] Overlay renders on top of backdrop sprite

## Implementation Notes

### File: `crates/crt-renderer/src/effects/sprite.rs`

```rust
pub struct SpriteOverlayState {
    pub config: SpriteOverlay,
    pub texture: wgpu::Texture,
    pub current_frame: u32,
    pub frame_timer: f32,
    pub position: (f32, f32),  // Computed position
    pub completed: bool,
}

impl SpriteOverlayState {
    pub fn update(&mut self, dt: f32, backdrop_pos: Option<(f32, f32)>, cursor_pos: (f32, f32)) {
        // Update position if tracking sprite
        if self.config.position == SpriteOverlayPosition::Sprite {
            if let Some(pos) = backdrop_pos {
                self.position = pos;
            }
        }
        
        // Advance animation
        self.frame_timer += dt;
        if self.frame_timer >= 1.0 / self.config.fps {
            self.frame_timer = 0.0;
            self.current_frame += 1;
            if self.current_frame >= self.config.columns * self.config.rows {
                self.completed = true;
            }
        }
    }
}
```

### Dependencies
- CRT-T-0139 (renderer creates overlay when override triggers)
- Existing sprite rendering pipeline

## Status Updates

*To be added during implementation*