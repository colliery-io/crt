---
id: detect-bell-and-osc-133-events-in
level: task
title: "Detect bell and OSC 133 events in crt-core"
short_code: "CRT-T-0138"
created_at: 2025-12-29T18:52:00.808930+00:00
updated_at: 2025-12-29T19:22:00.956585+00:00
parent: CRT-I-0016
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0016
---

# Detect bell and OSC 133 events in crt-core

**Phase 3** - Terminal-level event detection.

## Objective

Detect BEL character and OSC 133;D sequences in the terminal processor, emitting TerminalEvent for the renderer to handle.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Detect BEL character (0x07) and emit `TerminalEvent::Bell`
- [ ] Parse OSC 133;D;N sequences and extract exit code
- [ ] Emit `TerminalEvent::CommandSuccess` for exit code 0
- [ ] Emit `TerminalEvent::CommandFail(code)` for non-zero exit codes
- [ ] Events are queued/stored for renderer to poll
- [ ] No performance regression in normal terminal processing

## Implementation Notes

### File: `crates/crt-core/src/lib.rs`

Bell detection - in character processing:
```rust
if byte == 0x07 {
    self.events.push(TerminalEvent::Bell);
}
```

OSC 133 parsing - in OSC handler:
```rust
if params.starts_with("133;D") {
    let exit_code = params.split(';').nth(2)
        .and_then(|s| s.parse::<i32>().ok())
        .unwrap_or(0);
    if exit_code == 0 {
        self.events.push(TerminalEvent::CommandSuccess);
    } else {
        self.events.push(TerminalEvent::CommandFail(exit_code));
    }
}
```

### Dependencies
- CRT-T-0136 (TerminalEvent enum)

## Status Updates

*To be added during implementation*