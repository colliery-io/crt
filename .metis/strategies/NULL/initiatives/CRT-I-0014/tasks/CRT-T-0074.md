---
id: wire-effectsrenderer-into-render
level: task
title: "Wire EffectsRenderer into render pipeline"
short_code: "CRT-T-0074"
created_at: 2025-11-27T14:03:59.673608+00:00
updated_at: 2025-11-27T14:49:26.882499+00:00
parent: CRT-I-0014
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0014
---

# Wire EffectsRenderer into render pipeline

*This template includes sections for various types of tasks. Delete sections that don't apply to your specific use case.*

## Parent Initiative

[[CRT-I-0014]] - Vello-Powered Backdrop Effects System

## Objective

Wire the `EffectsRenderer` into the main render pipeline so effects are rendered to texture and composited into the background pass. This completes Phase 1 foundation work.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Create `EffectsRenderer` instance in `window.rs` or appropriate location
- [ ] Pass shared `VelloRenderer` from `gpu.rs` to `EffectsRenderer`
- [ ] Call `effects_renderer.update(dt)` each frame
- [ ] Call `effects_renderer.render()` to get effects texture
- [ ] Composite effects texture in background pass (before terminal content)
- [ ] Effects render correctly under terminal text
- [ ] Hot-reload triggers effect reconfiguration
- [ ] Grid effect displays when `--grid-enabled: true` in theme
- [ ] Code compiles with no errors

## Implementation Notes

### Technical Approach

```rust
// In window.rs or render coordinator
struct RenderState {
    // ... existing fields
    effects_renderer: EffectsRenderer,
}

impl RenderState {
    fn new(...) -> Self {
        let effects_renderer = EffectsRenderer::new(
            Arc::clone(&gpu.vello_renderer)
        );
        // ...
    }
    
    fn render(&mut self, ...) {
        // Update effects
        self.effects_renderer.update(dt);
        
        // Render effects to texture
        let effects_texture = self.effects_renderer.render(device, queue, size);
        
        // Background pass samples effects_texture
        // ... existing render pipeline
    }
    
    fn on_theme_change(&mut self, theme: &Theme) {
        self.effects_renderer.configure(theme);
    }
}
```

### Pipeline Integration
Current pipeline: Background -> Image -> Cells -> Text -> Composite -> Overlays -> Tab bar

New pipeline: **Effects** -> Background -> Image -> Cells -> Text -> Composite -> Overlays -> Tab bar

Or composite effects into Background pass.

### Dependencies
- CRT-T-0071 (effects module)
- CRT-T-0073 (GridEffect to test with)

### Files to Modify
- `src/window.rs` - create EffectsRenderer, wire update/render
- `crates/crt-renderer/src/lib.rs` - export effects module
- Background shader or composite pass - sample effects texture

## Status Updates

*To be added during implementation*