---
id: port-grid-from-wgsl-to-vello-as
level: task
title: "Port grid from WGSL to Vello as GridEffect"
short_code: "CRT-T-0073"
created_at: 2025-11-27T14:03:59.571468+00:00
updated_at: 2025-11-27T14:27:26.378926+00:00
parent: CRT-I-0014
blocked_by: []
archived: false

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0014
---

# Port grid from WGSL to Vello as GridEffect

*This template includes sections for various types of tasks. Delete sections that don't apply to your specific use case.*

## Parent Initiative

[[CRT-I-0014]] - Vello-Powered Backdrop Effects System

## Objective

Port the existing perspective grid rendering from WGSL shader (`background.wgsl`) to a Vello-based `GridEffect`. This proves the architecture works and maintains visual parity with the existing grid.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Create `crates/crt-renderer/src/effects/grid.rs`
- [ ] Implement `GridEffect` struct with configuration fields
- [ ] Implement `BackdropEffect` trait for `GridEffect`
- [ ] Render horizontal grid lines with perspective (closer = wider spacing)
- [ ] Render vertical grid lines
- [ ] Support `--grid-enabled`, `--grid-color`, `--grid-spacing` properties
- [ ] Support `--grid-perspective`, `--grid-horizon` properties
- [ ] Support `--grid-animation-speed` for scrolling effect
- [ ] Visual output matches existing WGSL grid appearance
- [ ] Code compiles with no errors

## Implementation Notes

### Technical Approach

```rust
// crates/crt-renderer/src/effects/grid.rs
pub struct GridEffect {
    enabled: bool,
    color: peniko::Color,
    spacing: f64,
    line_width: f64,
    perspective: f64,      // 0.0 = flat, 1.0 = full perspective
    horizon: f64,          // 0.0 = top, 1.0 = bottom
    animation_speed: f64,
    time_offset: f64,
}

impl BackdropEffect for GridEffect {
    fn render(&self, scene: &mut Scene, bounds: Rect) {
        if !self.enabled { return; }
        
        let horizon_y = bounds.y0 + bounds.height() * self.horizon;
        
        // Draw horizontal lines with perspective spacing
        for i in 0..line_count {
            let t = i as f64 / line_count as f64;
            let y = lerp_perspective(horizon_y, bounds.y1, t, self.perspective);
            let line = Line::new((bounds.x0, y), (bounds.x1, y));
            scene.stroke(&Stroke::new(self.line_width), Affine::IDENTITY, self.color, None, &line);
        }
        
        // Draw vertical lines converging toward horizon
        // ...
    }
}
```

### Dependencies
- CRT-T-0071 (effects module and trait)
- Reference: `crates/crt-renderer/src/shaders/background.wgsl`

### Files to Create
- `crates/crt-renderer/src/effects/grid.rs`

## Status Updates

*To be added during implementation*