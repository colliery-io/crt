---
id: move-theme-ownership-from-app-to
level: task
title: "Move theme ownership from App to WindowState"
short_code: "CRT-T-0157"
created_at: 2025-12-31T14:37:49.010351+00:00
updated_at: 2025-12-31T14:53:54.062041+00:00
parent: CRT-I-0025
blocked_by: []
archived: true

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0025
---

# Move theme ownership from App to WindowState

## Parent Initiative
[[CRT-I-0025]] - Per-Window Theme Switching

## Objective

Move theme storage from the global `App` struct to per-window `WindowState`, enabling each window to have its own theme. Add a `set_theme()` method that updates the window's GPU resources (effect pipeline, tab bar) when the theme changes.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] `WindowState` has `theme: Theme` and `theme_name: String` fields
- [ ] Remove `theme: Theme` field from `App` struct
- [ ] `WindowState::set_theme(&mut self, name: &str, theme: Theme)` method implemented
- [ ] `set_theme()` updates `effect_pipeline`, `tab_bar`, cursor colors, and marks dirty
- [ ] New windows get default theme from `ThemeRegistry`
- [ ] `reload_theme()` in App updates each window's theme individually
- [ ] Event overrides still work (access theme from WindowState instead of App)

## Implementation Notes

### Technical Approach

**WindowState changes (`src/window.rs`):**
```rust
pub struct WindowState {
    // ... existing fields ...
    pub theme: Theme,
    pub theme_name: String,
}

impl WindowState {
    pub fn set_theme(&mut self, name: &str, theme: Theme) {
        self.theme_name = name.to_string();
        self.theme = theme.clone();
        self.gpu.effect_pipeline.set_theme(theme.clone());
        self.gpu.tab_bar.set_theme(theme.tabs);
        // Update cursor colors, etc.
        self.render.dirty = true;
    }
}
```

**App changes (`src/main.rs`):**
- Remove `theme: Theme` field
- Keep `theme_registry: ThemeRegistry`
- `create_window()`: Get default theme from registry, pass to WindowState
- `reload_theme()`: Iterate windows, call `state.set_theme()` for each

### Files to Modify
- `src/window.rs`: Add theme fields and `set_theme()` method
- `src/main.rs`: Remove App.theme, update create_window, update reload_theme

### Dependencies
- Requires CRT-T-0156 (ThemeRegistry) to be completed first

## Status Updates

*To be added during implementation*