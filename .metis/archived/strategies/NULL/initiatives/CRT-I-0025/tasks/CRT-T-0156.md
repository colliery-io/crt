---
id: create-themeregistry-to-scan-and
level: task
title: "Create ThemeRegistry to scan and cache available themes"
short_code: "CRT-T-0156"
created_at: 2025-12-31T14:37:48.920910+00:00
updated_at: 2025-12-31T14:50:42.845082+00:00
parent: CRT-I-0025
blocked_by: []
archived: true

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0025
---

# Create ThemeRegistry to scan and cache available themes

## Parent Initiative
[[CRT-I-0025]] - Per-Window Theme Switching

## Objective

Create a `ThemeRegistry` struct that scans `~/.config/crt/themes/` at startup, parses all `.css` theme files, and caches them for runtime theme switching. This replaces the current single-theme loading with a registry that supports multiple themes.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] `ThemeRegistry` struct created in `src/theme_registry.rs`
- [ ] Scans themes directory and loads all `.css` files on initialization
- [ ] Provides `list_themes() -> Vec<&str>` for UI population
- [ ] Provides `get_theme(name) -> Option<&Theme>` for theme lookup
- [ ] Provides `get_default_theme()` returning configured default or first available
- [ ] Handles missing themes directory gracefully (empty registry)
- [ ] Handles malformed theme files gracefully (log warning, skip)
- [ ] Integrated into `App` struct, replacing single `theme` field usage in `load_theme()`

## Implementation Notes

### Technical Approach

```rust
pub struct ThemeRegistry {
    themes: HashMap<String, Theme>,
    themes_dir: PathBuf,
    default_theme: String,
}

impl ThemeRegistry {
    pub fn new(themes_dir: PathBuf, default_theme: String) -> Self;
    pub fn scan_themes(&mut self);
    pub fn list_themes(&self) -> Vec<&str>;
    pub fn get_theme(&self, name: &str) -> Option<&Theme>;
    pub fn get_default_theme(&self) -> (&str, Theme);
    pub fn reload_theme(&mut self, name: &str) -> Result<(), String>;
}
```

### Files to Modify
- Create `src/theme_registry.rs`
- `src/main.rs`: Add `mod theme_registry`, add to `App` struct, use in `load_theme()`

### Dependencies
- Uses existing `ConfigPaths::themes_dir()` for directory location
- Uses existing `Theme::from_css_with_base()` for parsing

## Status Updates

- Created `src/theme_registry.rs` with full implementation