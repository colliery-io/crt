---
id: add-clipboard-paste-support-cmd-v
level: task
title: "Add clipboard paste support (Cmd+V) with bracketed paste mode"
short_code: "CRT-T-0050"
created_at: 2025-11-26T21:26:29.491170+00:00
updated_at: 2025-11-26T22:09:49.435990+00:00
parent: CRT-I-0010
blocked_by: []
archived: true

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0010
---

# Add clipboard paste support (Cmd+V) with bracketed paste mode

## Parent Initiative
[[CRT-I-0010]]

## Objective
Allow users to paste text from the system clipboard into the terminal using Cmd+V (macOS) or Ctrl+Shift+V (Linux). Support bracketed paste mode for proper paste handling in vim, zsh, and other applications.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Cmd+V (macOS) / Ctrl+Shift+V pastes clipboard content to terminal
- [ ] Bracketed paste mode wraps content with escape sequences when enabled
- [ ] Multi-line paste works correctly (preserves newlines)
- [ ] Large paste content handled without blocking UI
- [ ] Menu Edit > Paste action works
- [ ] Paste clears any existing selection

## Implementation Notes

### Current State
- Cmd+C copy already implemented via `pbcopy` (macOS)
- `src/menu.rs:348`: Paste menu action defined but not implemented
- `shell.send_input()` available to write bytes to PTY
- No bracketed paste mode tracking

### Technical Approach

**1. Read clipboard content**
```rust
// macOS: Use pbpaste
fn get_clipboard_content() -> Option<String> {
    std::process::Command::new("pbpaste")
        .output()
        .ok()
        .and_then(|o| String::from_utf8(o.stdout).ok())
}

// Alternative: Use arboard crate for cross-platform
```

**2. Handle Cmd+V in main.rs keyboard handler**
```rust
// In keyboard input handling
if modifiers.super_key() && key == Key::Character("v") {
    if let Some(content) = get_clipboard_content() {
        paste_to_terminal(state, &content);
    }
    return;
}
```

**3. Implement bracketed paste mode**
```rust
fn paste_to_terminal(state: &mut WindowState, content: &str) {
    let shell = get_active_shell(state);
    
    // Check if terminal has bracketed paste mode enabled
    // alacritty_terminal tracks this in term.mode()
    let bracketed = shell.terminal().inner().mode().contains(TermMode::BRACKETED_PASTE);
    
    if bracketed {
        shell.send_input(b"\x1b[200~");  // Paste start
        shell.send_input(content.as_bytes());
        shell.send_input(b"\x1b[201~");  // Paste end
    } else {
        shell.send_input(content.as_bytes());
    }
}
```

**4. Wire up menu action**
```rust
// In handle_menu_action
MenuAction::Paste => {
    if let Some(content) = get_clipboard_content() {
        paste_to_terminal(state, &content);
    }
}
```

### Files to Modify
- `src/main.rs`: Add Cmd+V keyboard handler
- `src/input.rs`: Add `paste_to_terminal()` function
- `src/menu.rs`: Implement `MenuAction::Paste` handling
- `crates/crt-core/src/lib.rs`: Expose `TermMode` if needed

### Dependencies
- alacritty_terminal `TermMode::BRACKETED_PASTE` flag
- `pbpaste` command on macOS (or `arboard` crate for cross-platform)

### Risk Considerations
- Very large clipboard content could flood PTY buffer - consider chunking
- Binary content in clipboard could cause issues - filter non-printable chars
- Need to re-export `TermMode` from alacritty_terminal for mode checking

## Status Updates
*To be added during implementation*