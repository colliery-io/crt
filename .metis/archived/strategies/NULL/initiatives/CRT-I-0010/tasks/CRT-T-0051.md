---
id: render-bold-italic-and-underline
level: task
title: "Render bold, italic, and underline text styles"
short_code: "CRT-T-0051"
created_at: 2025-11-26T21:26:30.409465+00:00
updated_at: 2025-11-26T22:18:21.279848+00:00
parent: CRT-I-0010
blocked_by: []
archived: true

tags:
  - "#task"
  - "#phase/completed"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0010
---

# Render bold, italic, and underline text styles

## Parent Initiative
[[CRT-I-0010]]

## Objective
Render text with bold, italic, and underline styles from ANSI SGR escape sequences. Currently all text renders in regular weight with no style variations, breaking display of man pages, syntax highlighting, and TUI apps that use these styles.

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

## Acceptance Criteria

- [ ] Bold text (SGR 1) renders with heavier weight or brighter color
- [ ] Italic text (SGR 3) renders with italic/oblique style
- [ ] Underline text (SGR 4) renders with underline decoration
- [ ] Strikethrough text (SGR 9) renders with line through middle
- [ ] Dim text (SGR 2) renders with reduced opacity/brightness
- [ ] Style combinations work (e.g., bold+italic+underline)
- [ ] Test with `man ls`, git diff, and syntax-highlighted code

## Implementation Notes

### Current State
- `crt-core/src/lib.rs:15`: `CellFlags` re-exported but never used
- `src/window.rs:183-202`: Only reads `cell.c`, `cell.point`, `cell.fg` - ignores `cell.flags`
- `crates/crt-renderer/src/glyph_cache.rs`: GlyphKey only has char+size, no style variant
- Single font loaded, no bold/italic variants

### Technical Approach

**1. Extend GlyphKey to include style**
```rust
// glyph_cache.rs
#[derive(Clone, Copy, PartialEq, Eq, Hash, Debug)]
pub struct GlyphKey {
    pub character: char,
    pub size_tenths: u16,
    pub bold: bool,
    pub italic: bool,
}
```

**2. Load font variants or synthesize**
Option A: Load separate font files for bold/italic
```rust
struct GlyphCache {
    regular_font: Vec<u8>,
    bold_font: Option<Vec<u8>>,
    italic_font: Option<Vec<u8>>,
    bold_italic_font: Option<Vec<u8>>,
}
```

Option B: Synthesize styles via swash
```rust
// For bold: use embolden or heavier weight
scaler.style(Style::Embolden);
// For italic: use oblique transform
scaler.style(Style::Oblique);
```

**3. Read cell flags in rendering loop**
```rust
// window.rs update_text_buffer()
for cell in content.display_iter {
    let flags = cell.flags;
    let bold = flags.contains(CellFlags::BOLD);
    let italic = flags.contains(CellFlags::ITALIC);
    let underline = flags.contains(CellFlags::UNDERLINE);
    let dim = flags.contains(CellFlags::DIM);
    
    // Adjust color for dim
    let mut color = ansi_color_to_rgba(cell.fg, palette, default_fg);
    if dim {
        color[3] *= 0.5;  // Reduce alpha
    }
    
    // Get styled glyph
    let key = GlyphKey::new(cell.c, font_size, bold, italic);
    if let Some(glyph) = self.gpu.glyph_cache.position_char_styled(key, x, y) {
        self.gpu.grid_renderer.push_glyphs(&[glyph], color);
    }
}
```

**4. Render underline/strikethrough decorations**
```rust
// After rendering glyph, if underline flag set
if underline {
    // Draw line at baseline via vello
    let y_underline = y + baseline_offset + 2.0;
    terminal_vello.add_underline(x, y_underline, cell_width, color);
}
if strikethrough {
    let y_strike = y + line_height / 2.0;
    terminal_vello.add_strikethrough(x, y_strike, cell_width, color);
}
```

### Files to Modify
- `crates/crt-renderer/src/glyph_cache.rs`: Add style to GlyphKey, load/synthesize variants
- `src/window.rs`: Read cell.flags, pass style info to glyph cache
- `crates/crt-renderer/src/terminal_vello.rs`: Add underline/strikethrough rendering

### Dependencies
- swash font rendering with style support
- vello for underline/strikethrough lines
- May need to bundle bold/italic font files

### Risk Considerations
- Synthesized bold/italic may look worse than true font variants
- Additional font variants increase memory usage
- Underline rendering needs to avoid overlapping with descenders

## Status Updates
*To be added during implementation*