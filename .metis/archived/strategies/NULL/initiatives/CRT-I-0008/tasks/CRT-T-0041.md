---
id: define-renderpass-trait-and
level: task
title: "Define RenderPass trait and refactor existing pipelines"
short_code: "CRT-T-0041"
created_at: 2025-11-26T17:50:53.691897+00:00
updated_at: 2025-11-26T17:50:53.691897+00:00
parent: CRT-I-0008
blocked_by: []
archived: true

tags:
  - "#task"
  - "#phase/todo"


exit_criteria_met: false
strategy_id: NULL
initiative_id: CRT-I-0008
---

# Define RenderPass trait and refactor existing pipelines

## Parent Initiative

[[CRT-I-0008]] - Terminal Rendering Pipeline and ANSI Color Support

## Objective

Create a pluggable render pipeline architecture with a `RenderPass` trait, enabling components to be routed through different rendering treatments (raw color vs glow effects).

## Acceptance Criteria

## Acceptance Criteria

- [ ] `RenderPass` trait defined with `prepare()` and `render()` methods
- [ ] `BackgroundPass` extracted from existing `BackgroundPipeline`
- [ ] `GlowPass` extracted from composite shader logic
- [ ] `RawColorPass` wrapper for direct-to-screen rendering
- [ ] Existing rendering still works unchanged
- [ ] Architecture documented for future pass additions

## Implementation Notes

### RenderPass Trait

```rust
pub trait RenderPass {
    /// Prepare GPU resources (upload uniforms, etc.)
    fn prepare(&mut self, queue: &wgpu::Queue);
    
    /// Execute the render pass
    fn render<'a>(&'a self, pass: &mut wgpu::RenderPass<'a>);
}
```

### Technical Approach

1. Define `RenderPass` trait in `crates/crt-renderer/src/pass.rs`
2. Refactor `BackgroundPipeline` to implement `RenderPass`
3. Extract glow logic into standalone `GlowPass`
4. Create `RawColorPass` that renders directly without effects
5. Update `src/render.rs` to use trait-based rendering

### Component Pipeline Mapping

| Component      | Pipeline                              |
|----------------|---------------------------------------|
| Background     | BackgroundPass -> screen              |
| Terminal text  | RawColorPass -> screen (no effects)   |
| Cursor         | RawColorPass -> GlowPass -> screen    |
| Tab bar        | RawColorPass -> screen                |
| Tab titles     | RawColorPass -> GlowPass -> screen    |

### Files to Create/Modify

- `crates/crt-renderer/src/pass.rs` (new) - RenderPass trait
- `crates/crt-renderer/src/background.rs` - Implement RenderPass
- `crates/crt-renderer/src/glow.rs` (new) - GlowPass
- `crates/crt-renderer/src/lib.rs` - Export new types

### Risk Considerations

- Must maintain visual parity with current rendering
- Performance should not regress

## Status Updates

*To be added during implementation*